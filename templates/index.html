<!DOCTYPE html>
<html>
<head>
    <title>Room Sign-In</title>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
<div class="main-container">
    <div class="card shadow-lg p-4 form-card">

        <h2 class="text-center mb-4 fw-bold">Room Sign-In / Sign-Out</h2>

        <!-- ERROR MESSAGE -->
        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <!-- Sign In/Out Form -->
        <form method="POST" action="/sign">
            <label class="form-label fw-semibold">Your Name</label>

            <input list="names" name="name" class="form-control form-control-lg"
                   placeholder="Type or select your name" required
                   value="{{ form_name or '' }}">

            <datalist id="names">
                {% for name in names %}
                    <option value="{{ name }}">
                {% endfor %}
            </datalist>

            <!-- Time Selection -->
            <label class="form-label fw-semibold mt-3">Time</label>

            <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="use_current_time" name="use_current_time"
                       {% if form_use_current_time is not defined or form_use_current_time == True %}checked{% endif %}>
                <label class="form-check-label" for="use_current_time">
                    Use current time
                </label>
            </div>

            <input type="time" id="manual_time" name="manual_time"
                class="form-control form-control-lg"
                value="{{ form_manual_time or '' }}"
                {% if form_use_current_time is not defined or form_use_current_time == True %}disabled{% endif %}>


            <div class="d-flex justify-content-center gap-3 mt-4">
                <button name="action" value="IN" class="btn btn-success btn-lg px-4 {% if form_action == 'IN' %}active{% endif %}">Sign In</button>
                <button name="action" value="OUT" class="btn btn-danger btn-lg px-4 {% if form_action == 'OUT' %}active{% endif %}">Sign Out</button>
            </div>
        </form>

        <div class="text-center mt-4">
            <a href="/admin" class="admin-link">Go to Admin Logs</a>
        </div>

        <hr class="my-4">

        <!-- CSV-Style Logs Table -->
        <h3 class="text-center mb-3 fw-bold">Current Logs</h3>

        <div class="table-responsive">
            <table class="table table-striped table-bordered bg-white text-dark">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Time In</th><th>Time Out</th>
                        <th>Time In</th><th>Time Out</th>
                        <th>Time In</th><th>Time Out</th>
                        <th>Time In</th><th>Time Out</th>
                    </tr>
                </thead>

                <tbody>
                    {% for name, date, pairs in grouped_rows %}
                        {% set chunk = pairs[:4] %}
                        <tr>
                            <td>{{ name }}</td>
                            <td>{{ date }}</td>

                            {% for pin, pout in chunk %}
                                <td>{{ pin }}</td>
                                <td>{{ pout }}</td>
                            {% endfor %}

                            {% for i in range(4 - chunk|length) %}
                                <td></td><td></td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>
</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const useCurrentTimeCheckbox = document.getElementById("use_current_time");
    const manualTimeInput = document.getElementById("manual_time");
    
    // Set initial state based on checkbox
    manualTimeInput.disabled = useCurrentTimeCheckbox.checked;
    
    // Update when checkbox changes
    useCurrentTimeCheckbox.addEventListener("change", function () {
        manualTimeInput.disabled = this.checked;   // Disable when checked
    if (!this.checked) {
            manualTimeInput.focus();               // Auto-focus when enabled
    }
    });
});
</script>
